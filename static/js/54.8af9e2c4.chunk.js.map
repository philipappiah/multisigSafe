{"version":3,"sources":["components/Divider/index.tsx","utils/url.ts","routes/safe/components/Apps/hooks/useAppList.ts","routes/safe/components/Apps/components/ConfirmTxModal/SafeAppLoadError.tsx","components/ModalTitle/index.tsx","logic/safe/transactions/multisend.ts","components/DecodeTxs/index.tsx","utils/decodeTx.ts","routes/safe/components/Apps/components/ConfirmTxModal/ReviewConfirm.tsx","routes/safe/components/Apps/components/ConfirmTxModal/DecodedTxDetail.tsx","routes/safe/components/Apps/components/AppCard/index.tsx","routes/safe/components/Apps/components/ConfirmTxModal/index.tsx","routes/safe/components/Apps/hooks/useIframeMessageHandler.ts","routes/safe/components/Apps/hooks/useLegalConsent.ts","routes/safe/components/Apps/components/LegalDisclaimer.tsx","routes/safe/components/Apps/communicator.ts","routes/safe/components/Apps/components/AppFrame.tsx","routes/safe/components/Apps/components/AppCard/skeleton.tsx","routes/safe/components/Apps/assets/addApp.svg","routes/safe/components/Apps/components/AddAppForm/AppAgreement.tsx","logic/hooks/useDebounce.tsx","routes/safe/components/Apps/components/AddAppForm/AppUrl.tsx","routes/safe/components/Apps/components/AddAppForm/FormButtons.tsx","routes/safe/components/Apps/components/AddAppForm/index.tsx","routes/safe/components/Apps/components/AppsList.tsx","routes/safe/components/Apps/index.tsx"],"names":["Wrapper","styled","div","StyledDivider","DividerSRC","Divider","withArrow","type","size","isValidURL","url","protocolsAllowed","urlInfo","URL","includes","protocol","error","useAppList","useState","appList","setAppList","staticAppsList","setStaticAppsList","useEffect","loadAppsList","a","getAppsList","remoteAppsList","length","fetchAppCallback","res","prevStatus","cpPrevStatus","appIndex","findIndex","newStatus","SAFE_APP_FETCH_STATUS","ERROR","SUCCESS","fetchStatus","sort","b","name","toLowerCase","localeCompare","loadFromStorage","APPS_STORAGE_KEY","persistedAppList","customApps","filter","persistedApp","some","staticApp","apps","app","networks","getNetworkId","map","getEmptySafeApp","trim","forEach","getAppInfoFromUrl","then","loadApps","removeApp","useCallback","appUrl","list","newList","disabled","saveToStorage","IconText","FooterWrapper","SafeAppLoadError","onTxReject","onClose","color","cancelText","handleCancel","handleOk","okDisabled","okText","StyledParagraph","Paragraph","lg","IconImg","img","TitleWrapper","StyledRow","Row","md","StyledClose","Close","GoBackWrapper","ModalTitle","goBack","iconUrl","title","align","grow","IconButton","onClick","alt","src","noMargin","weight","disableRipple","multiSendAbi","constant","payable","stateMutability","inputs","outputs","FlexWrapper","margin","BasicTxInfoWrapper","TxList","theme","colors","separator","TxListItem","ElementWrapper","BasicTxInfo","txRecipient","txData","txValue","nativeCoin","getNetworkInfo","strong","symbol","hash","showAvatar","textSize","showCopyBtn","explorerUrl","getExplorerInfo","web3","utils","hexToBytes","textToCopy","getParameterElement","parameter","index","valueElement","value","startsWith","endsWith","JSON","stringify","e","key","SingleTx","decodedData","onTxItemClick","iconSize","iconType","text","method","MultiSendTx","txs","get","tx","dataDecoded","DecodeTxs","fetchTxDecoder","getTxServiceUrl","axios","post","data","Container","TransactionFeesWrapper","background","sm","DecodeTxsWrapper","StyledBlock","Block","ReviewConfirm","safeAddress","ethBalance","safeName","params","hidden","onUserConfirm","areTxsMalformed","showDecodedTxData","isMultiSend","setDecodedData","dispatch","useDispatch","useMemo","MULTI_SEND_ADDRESS","to","getWeb3","multiSend","eth","Contract","joinedTxs","abi","encodeParameter","slice","replace","join","methods","encodeABI","encodeMultiSendCall","web3ReadOnly","toBN","toString","operation","DELEGATE_CALL","CALL","manualSafeTxGas","setManualSafeTxGas","manualGasPrice","setManualGasPrice","manualGasLimit","setManualGasLimit","useEstimateTransactionGas","txAmount","safeTxGas","gasLimit","gasPriceFormatted","gasEstimation","isOffChainSignature","isCreation","isExecution","gasCostFormatted","txEstimationExecutionStatus","useEstimationStatus","buttonStatus","setButtonStatus","decodeTxData","handleTxRejection","handleUserConfirmation","safeTxHash","confirmTransactions","txParameters","ButtonStatus","LOADING","createTransaction","valueInWei","origin","id","navigateToTransactionsTab","txNonce","safeNonce","Number","undefined","ethParameters","notifiedTransaction","TX_NOTIFICATION_TYPES","STANDARD_TX","READY","EditableTxParameters","ethGasLimit","ethGasPrice","Math","max","closeEditModalCallback","oldGasPrice","newGasPrice","oldSafeTxGas","newSafeTxGas","toggleEditMode","Hairline","fromTokenUnit","decimals","TxParametersDetail","onEdit","isTransactionCreation","isTransactionExecution","EstimationStatus","Modal","Footer","withoutBorder","Buttons","cancelButtonProps","confirmButtonProps","status","TriggerType","DecodedTxDetail","body","hideDecodedTxData","decodedTxData","parameters","p","ConfirmTxModal","props","decodedTxDetails","setDecodedTxDetails","t","test","mustBeEthereumAddress","isTxValid","description","open","isOpen","NETWORK_NAME","getNetworkName","APPS_LEGAL_CONSENT_RECEIVED","LegalDisclaimer","onCancel","onConfirm","href","rel","target","AppCommunicator","iframeRef","handlers","Map","on","handler","set","isValidMessage","msg","sentFromIframe","source","parent","window","knownMethod","Object","values","METHODS","canHandleMessage","Boolean","send","requestId","sdkVersion","getSDKVersion","MessageFormatter","makeErrorResponse","makeResponse","current","contentWindow","postMessage","handleIncomingMessage","validMessage","hasHandler","response","message","trackError","Errors","_901","contexts","safeApp","request","clear","removeEventListener","this","addEventListener","OwnerDisclaimer","AppWrapper","StyledCard","Card","StyledIframe","iframe","isLoading","NETWORK_ID","INITIAL_CONFIRM_TX_MODAL_STATE","AppFrame","granted","useSelector","grantedSelector","safeParamAddressFromStateSelector","safeEthBalanceSelector","useSafeName","trackEvent","useAnalytics","history","useHistory","consentReceived","setConsentReceived","storedConsentReceived","checkLegalDisclaimer","onConsentReceipt","useLegalConsent","useRef","confirmTransactionModal","setConfirmTransactionModal","appIsLoading","setAppIsLoading","setSafeApp","timer","appTimeout","setAppTimeout","setTimeout","TIMEOUT","clearTimeout","openConfirmationModal","closeConfirmationModal","sendMessageToIframe","selectedApp","closeModal","useSnackbar","enqueueSnackbar","closeSnackbar","requestWithMessage","trunc","performance","now","version","handleIframeMessage","messageId","messagePayload","SDK_MESSAGES","SEND_TRANSACTIONS","SAFE_APP_SDK_INITIALIZED","safeInfoMessage","INTERFACE_MESSAGES","ON_SAFE_INFO","network","envInfoMessage","ENV_INFO","txServiceUrl","console","onIframeMessage","useIframeMessageHandler","onIframeLoad","url1","url2","isSameURL","communicator","setCommunicator","communicatorInstance","initCommunicator","useAppCommunicator","fetchSafeTransaction","chainId","currency","fetchTokenCurrenciesBalances","selectedCurrency","balances","Promise","resolve","reject","currentProvider","jsonrpc","call","err","result","loadApp","category","SAFE_NAVIGATION_EVENT","action","label","Error","push","SAFELIST_ADDRESS","style","flexDirection","frameBorder","ref","onLoad","TRANSACTION_CONFIRMED","TRANSACTION_REJECTED","gradientSK","keyframes","AppIconSK","TitleSK","DescriptionSK","StyledAppCard","fade","shadow","secondary","primary","AppName","Title","AppDescription","Text","setAppImageFallback","currentTarget","onerror","appsIconSvg","AppCard","className","buttonText","onError","variant","StyledCheckbox","Checkbox","AppAgreement","visited","useFormState","subscription","validate","agreementAccepted","required","Field","component","useDebouncedCallback","callback","delay","options","debounce","validateUrl","appUrlResolver","createDecorator","field","updates","isValidEnsName","getIpfsLinkFromEns","ensContent","AppInfoUpdater","onAppInfo","onLoading","debouncedValue","previousValue","setCurrent","debouncedCallback","cancel","useDebounce","useField","input","React","updateAppInfo","appInfo","StyledAppUrlField","AppUrl","composeValidators","uniqueApp","placeholder","TextField","autoComplete","FormButtons","valid","validating","isSubmitDisabled","fieldsVisited","isAppManifestValid","StyledTextFileAppName","AppInfo","AppDocsInfo","WrapperLoader","StyledLoader","Loader","INITIAL_VALUES","APP_INFO","AddApp","setAppInfo","matchSafeWithAddress","useRouteMatch","path","setIsLoading","GnoForm","decorators","initialValues","onSubmit","newAppList","goToApp","encodeURI","testId","Body","as","Img","width","readOnly","onChange","StyledLink","Link","centerCSS","css","LoadingContainer","CardsWrapper","ContentWrapper","Breadcrumb","IconBtn","AppContainer","AppsList","isAddAppModalOpen","setIsAddAppModalOpen","appToRemove","setAppToRemove","closeAddAppModal","AddAppIcon","isCustomApp","stopPropagation","handleClose","Header","AddAppForm","Apps","URLSearchParams","useLocation","search"],"mappings":"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","file":"static/js/54.8af9e2c4.chunk.js","sourcesContent":["import React, { ReactElement } from 'react'\r\nimport styled from 'styled-components'\r\nimport { Icon, Divider as DividerSRC } from '@gnosis.pm/safe-react-components'\r\n\r\nconst Wrapper = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  margin: 8px 0;\r\n\r\n  svg {\r\n    margin: 0 12px 0 4px;\r\n  }\r\n`\r\nconst StyledDivider = styled(DividerSRC)`\r\n  width: 100%;\r\n`\r\n\r\ntype Props = {\r\n  withArrow?: boolean\r\n}\r\n\r\nconst Divider = ({ withArrow }: Props): ReactElement => (\r\n  <Wrapper>\r\n    {withArrow && <Icon type=\"arrowDown\" size=\"md\" />}\r\n    <StyledDivider />\r\n  </Wrapper>\r\n)\r\n\r\nexport default Divider\r\n","export const isValidURL = (url: string, protocolsAllowed = ['https:', 'http:']): boolean => {\r\n  try {\r\n    const urlInfo = new URL(url)\r\n    return protocolsAllowed.includes(urlInfo.protocol)\r\n  } catch (error) {\r\n    return false\r\n  }\r\n}\r\n\r\nexport const isSameURL = (url1: string, url2: string): boolean => {\r\n  try {\r\n    const a = new URL(url1)\r\n    const b = new URL(url2)\r\n    return a.href === b.href\r\n  } catch (error) {\r\n    return false\r\n  }\r\n}\r\n","import { useState, useEffect, useCallback } from 'react'\r\nimport { loadFromStorage, saveToStorage } from 'src/utils/storage'\r\nimport { APPS_STORAGE_KEY, getAppInfoFromUrl, getAppsList, getEmptySafeApp } from '../utils'\r\nimport { AppData } from '../api/fetchSafeAppsList'\r\nimport { SafeApp, StoredSafeApp, SAFE_APP_FETCH_STATUS } from '../types'\r\nimport { getNetworkId } from 'src/config'\r\n\r\ntype UseAppListReturnType = {\r\n  appList: SafeApp[]\r\n  removeApp: (appUrl: string) => void\r\n  staticAppsList: AppData[]\r\n}\r\n\r\nconst useAppList = (): UseAppListReturnType => {\r\n  const [appList, setAppList] = useState<SafeApp[]>([])\r\n  const [staticAppsList, setStaticAppsList] = useState<AppData[]>([])\r\n\r\n  useEffect(() => {\r\n    const loadAppsList = async () => {\r\n      const remoteAppsList = await getAppsList()\r\n      setStaticAppsList(remoteAppsList)\r\n    }\r\n\r\n    if (!staticAppsList.length) {\r\n      loadAppsList()\r\n    }\r\n  }, [staticAppsList])\r\n\r\n  // Load apps list\r\n  // for each URL we return a mocked safe-app with a loading status\r\n  // it was developed to speed up initial page load, otherwise the\r\n  // app renders a loading until all the safe-apps are fetched.\r\n  useEffect(() => {\r\n    const fetchAppCallback = (res: SafeApp) => {\r\n      setAppList((prevStatus) => {\r\n        const cpPrevStatus = [...prevStatus]\r\n        const appIndex = cpPrevStatus.findIndex((a) => a.url === res.url)\r\n        const newStatus = res.error ? SAFE_APP_FETCH_STATUS.ERROR : SAFE_APP_FETCH_STATUS.SUCCESS\r\n        cpPrevStatus[appIndex] = { ...res, fetchStatus: newStatus }\r\n        return cpPrevStatus.sort((a, b) => a.name.toLowerCase().localeCompare(b.name.toLowerCase()))\r\n      })\r\n    }\r\n\r\n    const loadApps = async () => {\r\n      // recover apps from storage (third-party apps added by the user)\r\n      const persistedAppList =\r\n        (await loadFromStorage<(StoredSafeApp & { networks?: number[] })[]>(APPS_STORAGE_KEY)) || []\r\n\r\n      // backward compatibility. In a previous implementation a safe app could be disabled, that state was\r\n      // persisted in the storage.\r\n      const customApps = persistedAppList.filter(\r\n        (persistedApp) => !staticAppsList.some((staticApp) => staticApp.url === persistedApp.url),\r\n      )\r\n\r\n      const apps: SafeApp[] = [...staticAppsList, ...customApps]\r\n        // if the app does not expose supported networks, include them. (backward compatible)\r\n        .filter((app) => (!app.networks ? true : app.networks.includes(getNetworkId())))\r\n        .map((app) => ({\r\n          ...getEmptySafeApp(),\r\n          ...app,\r\n          url: app.url.trim(),\r\n        }))\r\n\r\n      setAppList(apps)\r\n\r\n      apps.forEach((app) => {\r\n        if (!app.name || app.name === 'unknown') {\r\n          // We are using legacy mode, we have to fetch info from manifest\r\n          getAppInfoFromUrl(app.url).then(fetchAppCallback)\r\n        } else {\r\n          // We already have manifest information so we directly add the app\r\n          fetchAppCallback(app)\r\n        }\r\n      })\r\n    }\r\n\r\n    loadApps()\r\n  }, [staticAppsList])\r\n\r\n  const removeApp = useCallback((appUrl: string): void => {\r\n    setAppList((list) => {\r\n      const newList = list.filter(({ url }) => url !== appUrl)\r\n      const persistedAppList = newList.map(({ url, disabled }) => ({ url, disabled }))\r\n      saveToStorage(APPS_STORAGE_KEY, persistedAppList)\r\n\r\n      return newList\r\n    })\r\n  }, [])\r\n\r\n  return {\r\n    appList,\r\n    staticAppsList,\r\n    removeApp,\r\n  }\r\n}\r\n\r\nexport { useAppList }\r\n","import React, { ReactElement } from 'react'\r\nimport { Icon, Text, Title, ModalFooterConfirmation } from '@gnosis.pm/safe-react-components'\r\nimport styled from 'styled-components'\r\nimport { ConfirmTxModalProps } from '.'\r\n\r\nconst IconText = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n\r\n  span {\r\n    margin-right: 4px;\r\n  }\r\n`\r\n\r\nconst FooterWrapper = styled.div`\r\n  margin-top: 15px;\r\n`\r\n\r\nexport const SafeAppLoadError = ({ onTxReject, onClose }: ConfirmTxModalProps): ReactElement => {\r\n  const handleTxRejection = () => {\r\n    onTxReject()\r\n    onClose()\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <IconText>\r\n        <Icon color=\"error\" size=\"md\" type=\"info\" />\r\n        <Title size=\"xs\">Transaction error</Title>\r\n      </IconText>\r\n      <Text size=\"lg\">\r\n        This Safe App initiated a transaction which cannot be processed. Please get in touch with the developer of this\r\n        Safe App for more information.\r\n      </Text>\r\n\r\n      <FooterWrapper>\r\n        <ModalFooterConfirmation\r\n          cancelText=\"Cancel\"\r\n          handleCancel={() => handleTxRejection()}\r\n          handleOk={() => {}}\r\n          okDisabled={true}\r\n          okText=\"Submit\"\r\n        />\r\n      </FooterWrapper>\r\n    </>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport styled from 'styled-components'\r\nimport IconButton from '@material-ui/core/IconButton'\r\nimport Close from '@material-ui/icons/Close'\r\nimport { Icon } from '@gnosis.pm/safe-react-components'\r\n\r\nimport Paragraph from 'src/components/layout/Paragraph'\r\nimport { md, lg } from 'src/theme/variables'\r\nimport Row from 'src/components/layout/Row'\r\n\r\nconst StyledParagraph = styled(Paragraph)`\r\n  && {\r\n    font-size: ${lg};\r\n    white-space: nowrap;\r\n    max-width: 370px;\r\n    overflow: hidden;\r\n  }\r\n`\r\nconst IconImg = styled.img`\r\n  width: 20px;\r\n  margin-right: 10px;\r\n`\r\nconst TitleWrapper = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n`\r\n\r\nconst StyledRow = styled(Row)`\r\n  padding: ${md} ${lg};\r\n  justify-content: space-between;\r\n  box-sizing: border-box;\r\n  max-height: 75px;\r\n`\r\n\r\nconst StyledClose = styled(Close)`\r\n  height: 35px;\r\n  width: 35px;\r\n`\r\n\r\nconst GoBackWrapper = styled.div`\r\n  margin-right: 15px;\r\n`\r\n\r\ntype Props = {\r\n  title: string\r\n  goBack?: () => void\r\n  iconUrl?: string\r\n  onClose?: () => void\r\n}\r\n\r\nconst ModalTitle = ({ goBack, iconUrl, title, onClose }: Props): React.ReactElement => {\r\n  return (\r\n    <StyledRow align=\"center\" grow>\r\n      <TitleWrapper>\r\n        {goBack && (\r\n          <GoBackWrapper>\r\n            <IconButton onClick={goBack}>\r\n              <Icon type=\"arrowLeft\" size=\"md\" />\r\n            </IconButton>\r\n          </GoBackWrapper>\r\n        )}\r\n        {iconUrl && <IconImg alt={title} src={iconUrl} />}\r\n        <StyledParagraph noMargin weight=\"bolder\" title={title}>\r\n          {title}\r\n        </StyledParagraph>\r\n      </TitleWrapper>\r\n      <IconButton disableRipple onClick={onClose}>\r\n        <StyledClose />\r\n      </IconButton>\r\n    </StyledRow>\r\n  )\r\n}\r\n\r\nexport default ModalTitle\r\n","import { Transaction } from '@gnosis.pm/safe-apps-sdk-v1'\r\nimport { AbiItem } from 'web3-utils'\r\nimport { MultiSend } from 'src/types/contracts/MultiSend.d'\r\nimport { getWeb3 } from 'src/logic/wallets/getWeb3'\r\nimport { MULTI_SEND_ADDRESS } from 'src/logic/contracts/safeContracts'\r\n\r\nconst multiSendAbi: AbiItem[] = [\r\n  {\r\n    type: 'function',\r\n    name: 'multiSend',\r\n    constant: false,\r\n    payable: false,\r\n    stateMutability: 'nonpayable',\r\n    inputs: [{ type: 'bytes', name: 'transactions' }],\r\n    outputs: [],\r\n  },\r\n]\r\n\r\nexport const encodeMultiSendCall = (txs: Transaction[]): string => {\r\n  const web3 = getWeb3()\r\n  const multiSend = (new web3.eth.Contract(multiSendAbi, MULTI_SEND_ADDRESS) as unknown) as MultiSend\r\n\r\n  const joinedTxs = txs\r\n    .map((tx) =>\r\n      [\r\n        web3.eth.abi.encodeParameter('uint8', 0).slice(-2),\r\n        web3.eth.abi.encodeParameter('address', tx.to).slice(-40),\r\n        web3.eth.abi.encodeParameter('uint256', tx.value).slice(-64),\r\n        web3.eth.abi.encodeParameter('uint256', web3.utils.hexToBytes(tx.data).length).slice(-64),\r\n        tx.data.replace(/^0x/, ''),\r\n      ].join(''),\r\n    )\r\n    .join('')\r\n\r\n  const encodedMultiSendCallData = multiSend.methods.multiSend(`0x${joinedTxs}`).encodeABI()\r\n\r\n  return encodedMultiSendCallData\r\n}\r\n","import React, { ReactElement } from 'react'\r\nimport styled from 'styled-components'\r\nimport { Transaction } from '@gnosis.pm/safe-apps-sdk-v1'\r\nimport { Text, EthHashInfo, CopyToClipboardBtn, IconText, FixedIcon } from '@gnosis.pm/safe-react-components'\r\nimport get from 'lodash.get'\r\n\r\nimport { web3ReadOnly as web3 } from 'src/logic/wallets/getWeb3'\r\nimport { getExplorerInfo, getNetworkInfo } from 'src/config'\r\nimport { DecodedData, DecodedDataBasicParameter, DecodedDataParameterValue } from 'src/types/transactions/decode.d'\r\nimport { DecodedTxDetail } from 'src/routes/safe/components/Apps/components/ConfirmTxModal'\r\n\r\nconst FlexWrapper = styled.div<{ margin: number }>`\r\n  display: flex;\r\n  align-items: center;\r\n\r\n  > :nth-child(2) {\r\n    margin-left: ${({ margin }) => margin}px;\r\n  }\r\n`\r\n\r\nconst BasicTxInfoWrapper = styled.div`\r\n  margin-bottom: 15px;\r\n\r\n  > :nth-child(2) {\r\n    margin-bottom: 15px;\r\n  }\r\n`\r\n\r\nconst TxList = styled.div`\r\n  width: 100%;\r\n  max-height: 260px;\r\n  overflow-y: auto;\r\n  border-top: 2px solid ${({ theme }) => theme.colors.separator};\r\n`\r\n\r\nconst TxListItem = styled.div`\r\n  display: flex;\r\n  justify-content: space-between;\r\n\r\n  padding: 0 24px;\r\n  height: 50px;\r\n  border-bottom: 2px solid ${({ theme }) => theme.colors.separator};\r\n\r\n  :hover {\r\n    cursor: pointer;\r\n  }\r\n`\r\nconst ElementWrapper = styled.div`\r\n  margin-bottom: 15px;\r\n`\r\n\r\nexport const BasicTxInfo = ({\r\n  txRecipient,\r\n  txData,\r\n  txValue,\r\n}: {\r\n  txRecipient: string\r\n  txData: string\r\n  txValue: string\r\n}): ReactElement => {\r\n  const { nativeCoin } = getNetworkInfo()\r\n\r\n  return (\r\n    <BasicTxInfoWrapper>\r\n      {/* TO */}\r\n      <>\r\n        <Text size=\"lg\" strong>\r\n          {`Send ${txValue} ${nativeCoin.symbol} to:`}\r\n        </Text>\r\n        <EthHashInfo\r\n          hash={txRecipient}\r\n          showAvatar\r\n          textSize=\"lg\"\r\n          showCopyBtn\r\n          explorerUrl={getExplorerInfo(txRecipient)}\r\n        />\r\n      </>\r\n      <>\r\n        {/* Data */}\r\n        <Text size=\"lg\" strong>\r\n          Data (hex encoded):\r\n        </Text>\r\n        <FlexWrapper margin={5}>\r\n          <Text size=\"lg\">{txData ? web3.utils.hexToBytes(txData).length : 0} bytes</Text>\r\n          <CopyToClipboardBtn textToCopy={txData} />\r\n        </FlexWrapper>\r\n      </>\r\n    </BasicTxInfoWrapper>\r\n  )\r\n}\r\n\r\nexport const getParameterElement = (parameter: DecodedDataBasicParameter, index: number): ReactElement => {\r\n  let valueElement\r\n\r\n  if (parameter.type === 'address') {\r\n    valueElement = (\r\n      <EthHashInfo\r\n        hash={parameter.value}\r\n        showAvatar\r\n        textSize=\"lg\"\r\n        showCopyBtn\r\n        explorerUrl={getExplorerInfo(parameter.value)}\r\n      />\r\n    )\r\n  }\r\n\r\n  if (parameter.type.startsWith('bytes')) {\r\n    valueElement = (\r\n      <FlexWrapper margin={5}>\r\n        <Text size=\"lg\">{web3.utils.hexToBytes(parameter.value).length} bytes</Text>\r\n        <CopyToClipboardBtn textToCopy={parameter.value} />\r\n      </FlexWrapper>\r\n    )\r\n  }\r\n\r\n  if (!valueElement) {\r\n    let value = parameter.value\r\n    if (parameter.type.endsWith('[]')) {\r\n      try {\r\n        value = JSON.stringify(parameter.value)\r\n      } catch (e) {}\r\n    }\r\n    valueElement = <Text size=\"lg\">{value}</Text>\r\n  }\r\n\r\n  return (\r\n    <ElementWrapper key={index}>\r\n      <Text size=\"lg\" strong>\r\n        {parameter.name} ({parameter.type})\r\n      </Text>\r\n      {valueElement}\r\n    </ElementWrapper>\r\n  )\r\n}\r\n\r\nconst SingleTx = ({\r\n  decodedData,\r\n  onTxItemClick,\r\n}: {\r\n  decodedData: DecodedData | null\r\n  onTxItemClick: (decodedTxDetails: DecodedData) => void\r\n}): ReactElement | null => {\r\n  if (!decodedData) {\r\n    return null\r\n  }\r\n\r\n  return (\r\n    <TxList>\r\n      <TxListItem onClick={() => onTxItemClick(decodedData)}>\r\n        <IconText iconSize=\"sm\" iconType=\"code\" text=\"Contract interaction\" textSize=\"xl\" />\r\n\r\n        <FlexWrapper margin={20}>\r\n          <Text size=\"xl\">{decodedData.method}</Text>\r\n          <FixedIcon type=\"chevronRight\" />\r\n        </FlexWrapper>\r\n      </TxListItem>\r\n    </TxList>\r\n  )\r\n}\r\n\r\nconst MultiSendTx = ({\r\n  decodedData,\r\n  onTxItemClick,\r\n}: {\r\n  decodedData: DecodedData | null\r\n  onTxItemClick: (decodedTxDetails: DecodedDataParameterValue) => void\r\n}): ReactElement | null => {\r\n  const txs: DecodedDataParameterValue[] | undefined = get(decodedData, 'parameters[0].valueDecoded')\r\n\r\n  if (!txs) {\r\n    return null\r\n  }\r\n\r\n  return (\r\n    <TxList>\r\n      {txs.map((tx, index) => (\r\n        <TxListItem key={index} onClick={() => onTxItemClick(tx)}>\r\n          <IconText iconSize=\"sm\" iconType=\"code\" text=\"Contract interaction\" textSize=\"xl\" />\r\n\r\n          <FlexWrapper margin={20}>\r\n            {tx.dataDecoded && <Text size=\"xl\">{tx.dataDecoded.method}</Text>}\r\n            <FixedIcon type=\"chevronRight\" />\r\n          </FlexWrapper>\r\n        </TxListItem>\r\n      ))}\r\n    </TxList>\r\n  )\r\n}\r\n\r\ntype Props = {\r\n  txs: Transaction[]\r\n  decodedData: DecodedData | null\r\n  onTxItemClick: (decodedTxDetails: DecodedTxDetail) => void\r\n}\r\n\r\nexport const DecodeTxs = ({ txs, decodedData, onTxItemClick }: Props): ReactElement => {\r\n  return txs.length > 1 ? (\r\n    <MultiSendTx decodedData={decodedData} onTxItemClick={onTxItemClick} />\r\n  ) : (\r\n    <SingleTx decodedData={decodedData} onTxItemClick={onTxItemClick} />\r\n  )\r\n}\r\n","import axios from 'axios'\r\n\r\nimport { getTxServiceUrl } from 'src/config'\r\nimport { DecodedData } from 'src/types/transactions/decode.d'\r\n\r\nexport const fetchTxDecoder = async (txData: string): Promise<DecodedData | null> => {\r\n  if (!txData?.length || txData === '0x') {\r\n    return null\r\n  }\r\n\r\n  const url = `${getTxServiceUrl()}/data-decoder/`\r\n  try {\r\n    const res = await axios.post<DecodedData>(url, { data: txData })\r\n    return res.data\r\n  } catch (error) {\r\n    return null\r\n  }\r\n}\r\n","import React, { ReactElement, useEffect, useMemo, useState } from 'react'\r\nimport { EthHashInfo, Text } from '@gnosis.pm/safe-react-components'\r\nimport styled from 'styled-components'\r\nimport { useDispatch } from 'react-redux'\r\n\r\nimport ModalTitle from 'src/components/ModalTitle'\r\nimport { createTransaction } from 'src/logic/safe/store/actions/createTransaction'\r\nimport { MULTI_SEND_ADDRESS } from 'src/logic/contracts/safeContracts'\r\nimport { CALL, DELEGATE_CALL, TX_NOTIFICATION_TYPES } from 'src/logic/safe/transactions'\r\nimport { encodeMultiSendCall } from 'src/logic/safe/transactions/multisend'\r\nimport { getExplorerInfo, getNetworkInfo } from 'src/config'\r\nimport { web3ReadOnly } from 'src/logic/wallets/getWeb3'\r\nimport { EstimationStatus, useEstimateTransactionGas } from 'src/logic/hooks/useEstimateTransactionGas'\r\nimport { TransactionFees } from 'src/components/TransactionsFees'\r\nimport { EditableTxParameters } from 'src/routes/safe/components/Transactions/helpers/EditableTxParameters'\r\nimport { TxParametersDetail } from 'src/routes/safe/components/Transactions/helpers/TxParametersDetail'\r\nimport { lg, md, sm } from 'src/theme/variables'\r\nimport { useEstimationStatus } from 'src/logic/hooks/useEstimationStatus'\r\nimport { TxParameters } from 'src/routes/safe/container/hooks/useTransactionParameters'\r\nimport { BasicTxInfo, DecodeTxs } from 'src/components/DecodeTxs'\r\nimport { fetchTxDecoder } from 'src/utils/decodeTx'\r\nimport { DecodedData } from 'src/types/transactions/decode.d'\r\nimport { fromTokenUnit } from 'src/logic/tokens/utils/humanReadableValue'\r\nimport Block from 'src/components/layout/Block'\r\nimport Divider from 'src/components/Divider'\r\n\r\nimport { ConfirmTxModalProps, DecodedTxDetail } from '.'\r\nimport Hairline from 'src/components/layout/Hairline'\r\nimport { ButtonStatus, Modal } from 'src/components/Modal'\r\n\r\nconst { nativeCoin } = getNetworkInfo()\r\n\r\nconst Container = styled.div`\r\n  max-width: 480px;\r\n  padding: ${md} ${lg} 0;\r\n`\r\nconst TransactionFeesWrapper = styled.div`\r\n  background-color: ${({ theme }) => theme.colors.background};\r\n  padding: ${sm} ${lg};\r\n`\r\n\r\nconst DecodeTxsWrapper = styled.div`\r\n  margin: 24px -24px;\r\n`\r\n\r\nconst StyledBlock = styled(Block)`\r\n  background-color: ${({ theme }) => theme.colors.separator};\r\n  width: fit-content;\r\n  padding: 5px 10px;\r\n  border-radius: 3px;\r\n  margin: 4px 0 0 40px;\r\n\r\n  display: flex;\r\n\r\n  > :nth-child(1) {\r\n    margin-right: 5px;\r\n  }\r\n`\r\n\r\ntype Props = ConfirmTxModalProps & {\r\n  areTxsMalformed: boolean\r\n  showDecodedTxData: (decodedTxDetails: DecodedTxDetail) => void\r\n  hidden: boolean // used to prevent re-rendering the modal each time a tx is inspected\r\n}\r\n\r\nconst parseTxValue = (value: string | number): string => {\r\n  return web3ReadOnly.utils.toBN(value).toString()\r\n}\r\n\r\nexport const ReviewConfirm = ({\r\n  app,\r\n  txs,\r\n  safeAddress,\r\n  ethBalance,\r\n  safeName,\r\n  params,\r\n  hidden,\r\n  onUserConfirm,\r\n  onClose,\r\n  onTxReject,\r\n  areTxsMalformed,\r\n  showDecodedTxData,\r\n}: Props): ReactElement => {\r\n  const isMultiSend = txs.length > 1\r\n  const [decodedData, setDecodedData] = useState<DecodedData | null>(null)\r\n  const dispatch = useDispatch()\r\n  const explorerUrl = getExplorerInfo(safeAddress)\r\n\r\n  const txRecipient: string | undefined = useMemo(() => (isMultiSend ? MULTI_SEND_ADDRESS : txs[0]?.to), [\r\n    txs,\r\n    isMultiSend,\r\n  ])\r\n  const txData: string | undefined = useMemo(() => (isMultiSend ? encodeMultiSendCall(txs) : txs[0]?.data), [\r\n    txs,\r\n    isMultiSend,\r\n  ])\r\n  const txValue: string | undefined = useMemo(\r\n    () => (isMultiSend ? '0' : txs[0]?.value && parseTxValue(txs[0]?.value)),\r\n    [txs, isMultiSend],\r\n  )\r\n  const operation = useMemo(() => (isMultiSend ? DELEGATE_CALL : CALL), [isMultiSend])\r\n  const [manualSafeTxGas, setManualSafeTxGas] = useState(0)\r\n  const [manualGasPrice, setManualGasPrice] = useState<string | undefined>()\r\n  const [manualGasLimit, setManualGasLimit] = useState<string | undefined>()\r\n\r\n  const {\r\n    gasLimit,\r\n    gasPriceFormatted,\r\n    gasEstimation,\r\n    isOffChainSignature,\r\n    isCreation,\r\n    isExecution,\r\n    gasCostFormatted,\r\n    txEstimationExecutionStatus,\r\n  } = useEstimateTransactionGas({\r\n    txData: txData || '',\r\n    txRecipient,\r\n    operation,\r\n    txAmount: txValue,\r\n    safeTxGas: manualSafeTxGas,\r\n    manualGasPrice,\r\n    manualGasLimit,\r\n  })\r\n\r\n  const [buttonStatus, setButtonStatus] = useEstimationStatus(txEstimationExecutionStatus)\r\n\r\n  // Decode tx data.\r\n  useEffect(() => {\r\n    const decodeTxData = async () => {\r\n      const res = await fetchTxDecoder(txData)\r\n      setDecodedData(res)\r\n    }\r\n\r\n    decodeTxData()\r\n  }, [txData])\r\n\r\n  const handleTxRejection = () => {\r\n    onTxReject()\r\n    onClose()\r\n  }\r\n\r\n  const handleUserConfirmation = (safeTxHash: string): void => {\r\n    onUserConfirm(safeTxHash)\r\n    onClose()\r\n  }\r\n\r\n  const confirmTransactions = async (txParameters: TxParameters) => {\r\n    setButtonStatus(ButtonStatus.LOADING)\r\n\r\n    await dispatch(\r\n      createTransaction(\r\n        {\r\n          safeAddress,\r\n          to: txRecipient,\r\n          valueInWei: txValue,\r\n          txData,\r\n          operation,\r\n          origin: app.id,\r\n          navigateToTransactionsTab: false,\r\n          txNonce: txParameters.safeNonce,\r\n          safeTxGas: txParameters.safeTxGas ? Number(txParameters.safeTxGas) : undefined,\r\n          ethParameters: txParameters,\r\n          notifiedTransaction: TX_NOTIFICATION_TYPES.STANDARD_TX,\r\n        },\r\n        handleUserConfirmation,\r\n        handleTxRejection,\r\n      ),\r\n    )\r\n\r\n    setButtonStatus(ButtonStatus.READY)\r\n  }\r\n\r\n  const closeEditModalCallback = (txParameters: TxParameters) => {\r\n    const oldGasPrice = Number(gasPriceFormatted)\r\n    const newGasPrice = Number(txParameters.ethGasPrice)\r\n    const oldSafeTxGas = Number(gasEstimation)\r\n    const newSafeTxGas = Number(txParameters.safeTxGas)\r\n\r\n    if (newGasPrice && oldGasPrice !== newGasPrice) {\r\n      setManualGasPrice(txParameters.ethGasPrice)\r\n    }\r\n\r\n    if (txParameters.ethGasLimit && gasLimit !== txParameters.ethGasLimit) {\r\n      setManualGasLimit(txParameters.ethGasLimit)\r\n    }\r\n\r\n    if (newSafeTxGas && oldSafeTxGas !== newSafeTxGas) {\r\n      setManualSafeTxGas(newSafeTxGas)\r\n    }\r\n  }\r\n\r\n  return (\r\n    <EditableTxParameters\r\n      ethGasLimit={gasLimit}\r\n      ethGasPrice={gasPriceFormatted}\r\n      safeTxGas={Math.max(gasEstimation, params?.safeTxGas || 0).toString()}\r\n      closeEditModalCallback={closeEditModalCallback}\r\n      isOffChainSignature={isOffChainSignature}\r\n      isExecution={isExecution}\r\n    >\r\n      {(txParameters, toggleEditMode) => (\r\n        <div hidden={hidden}>\r\n          <ModalTitle title={app.name} iconUrl={app.iconUrl} onClose={handleTxRejection} />\r\n\r\n          <Hairline />\r\n\r\n          <Container>\r\n            {/* Safe */}\r\n            <EthHashInfo name={safeName} hash={safeAddress} showAvatar showCopyBtn explorerUrl={explorerUrl} />\r\n            <StyledBlock>\r\n              <Text size=\"md\">Balance:</Text>\r\n              <Text size=\"md\" strong>{`${ethBalance} ${nativeCoin.symbol}`}</Text>\r\n            </StyledBlock>\r\n\r\n            <Divider withArrow />\r\n\r\n            {/* Txs decoded */}\r\n            <BasicTxInfo\r\n              txRecipient={txRecipient}\r\n              txData={txData}\r\n              txValue={fromTokenUnit(txValue, nativeCoin.decimals)}\r\n            />\r\n\r\n            <DecodeTxsWrapper>\r\n              <DecodeTxs txs={txs} decodedData={decodedData} onTxItemClick={showDecodedTxData} />\r\n            </DecodeTxsWrapper>\r\n            {!isMultiSend && <Divider />}\r\n            {/* Tx Parameters */}\r\n            <TxParametersDetail\r\n              txParameters={txParameters}\r\n              onEdit={toggleEditMode}\r\n              isTransactionCreation={isCreation}\r\n              isTransactionExecution={isExecution}\r\n              isOffChainSignature={isOffChainSignature}\r\n            />\r\n          </Container>\r\n\r\n          {/* Gas info */}\r\n          {txEstimationExecutionStatus === EstimationStatus.LOADING ? null : (\r\n            <TransactionFeesWrapper>\r\n              <TransactionFees\r\n                gasCostFormatted={gasCostFormatted}\r\n                isExecution={isExecution}\r\n                isCreation={isCreation}\r\n                isOffChainSignature={isOffChainSignature}\r\n                txEstimationExecutionStatus={txEstimationExecutionStatus}\r\n              />\r\n            </TransactionFeesWrapper>\r\n          )}\r\n\r\n          {/* Buttons */}\r\n          <Modal.Footer withoutBorder={txEstimationExecutionStatus !== EstimationStatus.LOADING}>\r\n            <Modal.Footer.Buttons\r\n              cancelButtonProps={{ onClick: handleTxRejection }}\r\n              confirmButtonProps={{\r\n                onClick: () => confirmTransactions(txParameters),\r\n                disabled: areTxsMalformed,\r\n                status: buttonStatus,\r\n                text: txEstimationExecutionStatus === EstimationStatus.LOADING ? 'Estimating' : undefined,\r\n              }}\r\n            />\r\n          </Modal.Footer>\r\n        </div>\r\n      )}\r\n    </EditableTxParameters>\r\n  )\r\n}\r\n","import React, { ReactElement } from 'react'\r\nimport styled from 'styled-components'\r\n\r\nimport { getNetworkInfo } from 'src/config'\r\nimport { fromTokenUnit } from 'src/logic/tokens/utils/humanReadableValue'\r\nimport { md, lg } from 'src/theme/variables'\r\nimport ModalTitle from 'src/components/ModalTitle'\r\nimport Hairline from 'src/components/layout/Hairline'\r\nimport { DecodedDataParameterValue, DecodedData } from 'src/types/transactions/decode.d'\r\nimport { BasicTxInfo, getParameterElement } from 'src/components/DecodeTxs'\r\n\r\nconst { nativeCoin } = getNetworkInfo()\r\n\r\nconst Container = styled.div`\r\n  max-width: 480px;\r\n  padding: ${md} ${lg};\r\n  word-break: break-word;\r\n`\r\n\r\nfunction isDataDecodedParameterValue(arg: any): arg is DecodedDataParameterValue {\r\n  return arg.operation !== undefined\r\n}\r\n\r\ntype Props = {\r\n  hideDecodedTxData: () => void\r\n  onClose: () => void\r\n  decodedTxData: DecodedDataParameterValue | DecodedData\r\n}\r\n\r\nexport const DecodedTxDetail = ({ hideDecodedTxData, onClose, decodedTxData: tx }: Props): ReactElement => {\r\n  let body\r\n  // If we are dealing with a multiSend\r\n  // decodedTxData is of type DataDecodedParameter\r\n  if (isDataDecodedParameterValue(tx)) {\r\n    const txValue = fromTokenUnit(tx.value, nativeCoin.decimals)\r\n\r\n    body = (\r\n      <>\r\n        <BasicTxInfo txRecipient={tx.to} txData={tx.data} txValue={txValue} />\r\n        {tx.dataDecoded?.parameters.map((p, index) => getParameterElement(p, index))}\r\n      </>\r\n    )\r\n  } else {\r\n    // If we are dealing with a single tx\r\n    // decodedTxData is of type DecodedData\r\n    body = <>{tx.parameters.map((p, index) => getParameterElement(p, index))}</>\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <ModalTitle\r\n        title={(tx as DecodedDataParameterValue).dataDecoded?.method || (tx as DecodedData).method}\r\n        onClose={onClose}\r\n        goBack={hideDecodedTxData}\r\n      />\r\n\r\n      <Hairline />\r\n\r\n      <Container>{body}</Container>\r\n    </>\r\n  )\r\n}\r\n","import React, { SyntheticEvent } from 'react'\r\nimport styled from 'styled-components'\r\nimport { fade } from '@material-ui/core/styles/colorManipulator'\r\nimport { Title, Text, Button, Card } from '@gnosis.pm/safe-react-components'\r\n\r\nimport appsIconSvg from 'src/assets/icons/apps.svg'\r\nimport { AppIconSK, DescriptionSK, TitleSK } from './skeleton'\r\n\r\nconst StyledAppCard = styled(Card)`\r\n  display: flex;\r\n  align-items: center;\r\n  flex-direction: column;\r\n  justify-content: space-evenly;\r\n  box-shadow: 1px 2px 10px 0 ${({ theme }) => fade(theme.colors.shadow.color, 0.18)};\r\n  height: 232px !important;\r\n  box-sizing: border-box;\r\n  cursor: pointer;\r\n  color: ${({ theme }) => theme.colors.secondary};\r\n\r\n  :hover {\r\n    box-shadow: 1px 2px 16px 0 ${({ theme }) => fade(theme.colors.shadow.color, 0.35)};\r\n    transition: box-shadow 0.3s ease-in-out;\r\n    background-color: ${({ theme }) => theme.colors.background};\r\n    cursor: pointer;\r\n\r\n    h5 {\r\n      color: ${({ theme }) => theme.colors.primary};\r\n    }\r\n  }\r\n`\r\n\r\nconst IconImg = styled.img<{ size: 'md' | 'lg'; src: string | undefined }>`\r\n  width: ${({ size }) => (size === 'md' ? '60px' : '102px')};\r\n  height: ${({ size }) => (size === 'md' ? '60px' : '92px')};\r\n  margin-top: ${({ size }) => (size === 'md' ? '0' : '-16px')};\r\n  object-fit: contain;\r\n`\r\n\r\nconst AppName = styled(Title)`\r\n  text-align: center;\r\n  margin: 16px 0 9px 0;\r\n`\r\n\r\nconst AppDescription = styled(Text)`\r\n  height: 71px;\r\n  text-align: center;\r\n`\r\n\r\nexport const setAppImageFallback = (error: SyntheticEvent<HTMLImageElement, Event>): void => {\r\n  error.currentTarget.onerror = null\r\n  error.currentTarget.src = appsIconSvg\r\n}\r\n\r\nexport enum TriggerType {\r\n  Button,\r\n  Content,\r\n}\r\n\r\ntype Props = {\r\n  onClick?: () => void\r\n  isLoading?: boolean\r\n  className?: string\r\n  name?: string\r\n  description?: string\r\n  iconUrl?: string\r\n  iconSize?: 'md' | 'lg'\r\n  buttonText?: string\r\n}\r\n\r\nconst AppCard = ({\r\n  isLoading = false,\r\n  className,\r\n  name,\r\n  description,\r\n  iconUrl,\r\n  iconSize = 'md',\r\n  buttonText,\r\n  onClick = () => undefined,\r\n}: Props): React.ReactElement => {\r\n  if (isLoading) {\r\n    return (\r\n      <StyledAppCard className={className}>\r\n        <AppIconSK />\r\n        <TitleSK />\r\n        <DescriptionSK />\r\n        <DescriptionSK />\r\n      </StyledAppCard>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <StyledAppCard className={className} onClick={onClick}>\r\n      <IconImg alt={`${name || 'App'} Logo`} src={iconUrl} onError={setAppImageFallback} size={iconSize} />\r\n\r\n      {name && <AppName size=\"xs\">{name}</AppName>}\r\n\r\n      {description && <AppDescription size=\"lg\">{description} </AppDescription>}\r\n\r\n      {buttonText && (\r\n        <Button size=\"md\" color=\"primary\" variant=\"contained\" onClick={onClick}>\r\n          {buttonText}\r\n        </Button>\r\n      )}\r\n    </StyledAppCard>\r\n  )\r\n}\r\n\r\nexport default AppCard\r\n","import React, { ReactElement, useState } from 'react'\r\nimport { Transaction } from '@gnosis.pm/safe-apps-sdk-v1'\r\n\r\nimport Modal from 'src/components/Modal'\r\nimport { SafeApp } from 'src/routes/safe/components/Apps/types'\r\nimport { TransactionParams } from 'src/routes/safe/components/Apps/components/AppFrame'\r\nimport { mustBeEthereumAddress } from 'src/components/forms/validator'\r\nimport { SafeAppLoadError } from './SafeAppLoadError'\r\nimport { ReviewConfirm } from './ReviewConfirm'\r\nimport { DecodedDataParameterValue, DecodedData } from 'src/types/transactions/decode'\r\nimport { DecodedTxDetail } from './DecodedTxDetail'\r\n\r\nexport type ConfirmTxModalProps = {\r\n  isOpen: boolean\r\n  app: SafeApp\r\n  txs: Transaction[]\r\n  params?: TransactionParams\r\n  safeAddress: string\r\n  safeName: string\r\n  ethBalance: string\r\n  onUserConfirm: (safeTxHash: string) => void\r\n  onTxReject: () => void\r\n  onClose: () => void\r\n}\r\n\r\nconst isTxValid = (t: Transaction): boolean => {\r\n  if (!['string', 'number'].includes(typeof t.value)) {\r\n    return false\r\n  }\r\n\r\n  if (typeof t.value === 'string' && !/^(0x)?[0-9a-f]+$/i.test(t.value)) {\r\n    return false\r\n  }\r\n\r\n  const isAddressValid = mustBeEthereumAddress(t.to) === undefined\r\n  return isAddressValid && !!t.data && typeof t.data === 'string'\r\n}\r\n\r\nexport type DecodedTxDetail = DecodedDataParameterValue | DecodedData | undefined\r\n\r\nexport const ConfirmTxModal = (props: ConfirmTxModalProps): ReactElement | null => {\r\n  const [decodedTxDetails, setDecodedTxDetails] = useState<DecodedTxDetail>()\r\n  const areTxsMalformed = props.txs.some((t) => !isTxValid(t))\r\n\r\n  const showDecodedTxData = setDecodedTxDetails\r\n  const hideDecodedTxData = () => setDecodedTxDetails(undefined)\r\n\r\n  const closeDecodedTxDetail = () => {\r\n    hideDecodedTxData()\r\n    props.onClose()\r\n  }\r\n\r\n  return (\r\n    <Modal description=\"Safe App transaction\" title=\"Safe App transaction\" open={props.isOpen}>\r\n      {areTxsMalformed && <SafeAppLoadError {...props} />}\r\n      {decodedTxDetails && (\r\n        <DecodedTxDetail\r\n          onClose={closeDecodedTxDetail}\r\n          hideDecodedTxData={hideDecodedTxData}\r\n          decodedTxData={decodedTxDetails}\r\n        />\r\n      )}\r\n\r\n      <ReviewConfirm\r\n        {...props}\r\n        areTxsMalformed={areTxsMalformed}\r\n        showDecodedTxData={showDecodedTxData}\r\n        hidden={areTxsMalformed || !!decodedTxDetails}\r\n      />\r\n    </Modal>\r\n  )\r\n}\r\n","import { useSnackbar } from 'notistack'\r\nimport {\r\n  InterfaceMessageIds,\r\n  InterfaceMessageToPayload,\r\n  SDKMessageIds,\r\n  SDKMessageToPayload,\r\n  SDK_MESSAGES,\r\n  INTERFACE_MESSAGES,\r\n  RequestId,\r\n  Transaction,\r\n  LowercaseNetworks,\r\n} from '@gnosis.pm/safe-apps-sdk-v1'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { useEffect, useCallback, MutableRefObject } from 'react'\r\n\r\nimport { getNetworkName, getTxServiceUrl } from 'src/config/'\r\nimport { useSafeName } from 'src/logic/addressBook/hooks/useSafeName'\r\nimport { safeEthBalanceSelector, safeParamAddressFromStateSelector } from 'src/logic/safe/store/selectors'\r\nimport { TransactionParams } from '../components/AppFrame'\r\nimport { SafeApp } from 'src/routes/safe/components/Apps/types'\r\n\r\ntype InterfaceMessageProps<T extends InterfaceMessageIds> = {\r\n  messageId: T\r\n  data: InterfaceMessageToPayload[T]\r\n}\r\n\r\ntype ReturnType = {\r\n  sendMessageToIframe: <T extends InterfaceMessageIds>(message: InterfaceMessageProps<T>, requestId?: RequestId) => void\r\n}\r\n\r\nconst NETWORK_NAME = getNetworkName()\r\n\r\nconst useIframeMessageHandler = (\r\n  selectedApp: SafeApp | undefined,\r\n  openConfirmationModal: (txs: Transaction[], params: TransactionParams | undefined, requestId: RequestId) => void,\r\n  closeModal: () => void,\r\n  iframeRef: MutableRefObject<HTMLIFrameElement | null>,\r\n): ReturnType => {\r\n  const { enqueueSnackbar, closeSnackbar } = useSnackbar()\r\n  const safeAddress = useSelector(safeParamAddressFromStateSelector)\r\n  const safeName = useSafeName(safeAddress)\r\n  const ethBalance = useSelector(safeEthBalanceSelector)\r\n  const dispatch = useDispatch()\r\n\r\n  const sendMessageToIframe = useCallback(\r\n    function <T extends InterfaceMessageIds>(message: InterfaceMessageProps<T>, requestId?: RequestId) {\r\n      const requestWithMessage = {\r\n        ...message,\r\n        requestId: requestId || Math.trunc(window.performance.now()),\r\n        version: '0.4.2',\r\n      }\r\n\r\n      if (iframeRef && selectedApp) {\r\n        iframeRef.current?.contentWindow?.postMessage(requestWithMessage, selectedApp.url)\r\n      }\r\n    },\r\n    [iframeRef, selectedApp],\r\n  )\r\n\r\n  useEffect(() => {\r\n    const handleIframeMessage = (\r\n      messageId: SDKMessageIds,\r\n      messagePayload: SDKMessageToPayload[typeof messageId],\r\n      requestId: RequestId,\r\n    ): void => {\r\n      if (!messageId) {\r\n        return\r\n      }\r\n\r\n      switch (messageId) {\r\n        // typescript doesn't narrow type in switch/case statements\r\n        // issue: https://github.com/microsoft/TypeScript/issues/20375\r\n        // possible solution: https://stackoverflow.com/a/43879897/7820085\r\n        case SDK_MESSAGES.SEND_TRANSACTIONS: {\r\n          if (messagePayload) {\r\n            openConfirmationModal(\r\n              messagePayload as SDKMessageToPayload[typeof SDK_MESSAGES.SEND_TRANSACTIONS],\r\n              undefined,\r\n              requestId,\r\n            )\r\n          }\r\n          break\r\n        }\r\n\r\n        case SDK_MESSAGES.SAFE_APP_SDK_INITIALIZED: {\r\n          const safeInfoMessage = {\r\n            messageId: INTERFACE_MESSAGES.ON_SAFE_INFO,\r\n            data: {\r\n              safeAddress: safeAddress as string,\r\n              network: NETWORK_NAME.toLowerCase() as LowercaseNetworks,\r\n              ethBalance: ethBalance as string,\r\n            },\r\n          }\r\n          const envInfoMessage = {\r\n            messageId: INTERFACE_MESSAGES.ENV_INFO,\r\n            data: {\r\n              txServiceUrl: getTxServiceUrl(),\r\n            },\r\n          }\r\n\r\n          sendMessageToIframe(safeInfoMessage)\r\n          sendMessageToIframe(envInfoMessage)\r\n          break\r\n        }\r\n        default: {\r\n          console.error(`ThirdPartyApp: A message was received with an unknown message id ${messageId}.`)\r\n          break\r\n        }\r\n      }\r\n    }\r\n    const onIframeMessage = async (\r\n      message: MessageEvent<{\r\n        requestId: RequestId\r\n        messageId: SDKMessageIds\r\n        data: SDKMessageToPayload[SDKMessageIds]\r\n      }>,\r\n    ) => {\r\n      if (message.origin === window.origin) {\r\n        return\r\n      }\r\n      if (!selectedApp?.url.includes(message.origin)) {\r\n        console.error(`ThirdPartyApp: A message was received from an unknown origin ${message.origin}`)\r\n        return\r\n      }\r\n      handleIframeMessage(message.data.messageId, message.data.data, message.data.requestId)\r\n    }\r\n\r\n    window.addEventListener('message', onIframeMessage)\r\n    return () => {\r\n      window.removeEventListener('message', onIframeMessage)\r\n    }\r\n  }, [\r\n    closeModal,\r\n    closeSnackbar,\r\n    dispatch,\r\n    enqueueSnackbar,\r\n    ethBalance,\r\n    openConfirmationModal,\r\n    safeAddress,\r\n    safeName,\r\n    selectedApp,\r\n    sendMessageToIframe,\r\n  ])\r\n\r\n  return {\r\n    sendMessageToIframe,\r\n  }\r\n}\r\n\r\nexport { useIframeMessageHandler }\r\n","import { useState, useEffect, useCallback } from 'react'\r\nimport { loadFromStorage, saveToStorage } from 'src/utils/storage'\r\n\r\nconst APPS_LEGAL_CONSENT_RECEIVED = 'APPS_LEGAL_CONSENT_RECEIVED'\r\n\r\nconst useLegalConsent = (): { consentReceived: boolean | undefined; onConsentReceipt: () => void } => {\r\n  const [consentReceived, setConsentReceived] = useState<boolean | undefined>()\r\n\r\n  useEffect(() => {\r\n    const checkLegalDisclaimer = async () => {\r\n      const storedConsentReceived = await loadFromStorage(APPS_LEGAL_CONSENT_RECEIVED)\r\n\r\n      if (storedConsentReceived) {\r\n        setConsentReceived(true)\r\n      } else {\r\n        setConsentReceived(false)\r\n      }\r\n    }\r\n\r\n    checkLegalDisclaimer()\r\n  }, [])\r\n\r\n  const onConsentReceipt = useCallback((): void => {\r\n    setConsentReceived(true)\r\n    saveToStorage(APPS_LEGAL_CONSENT_RECEIVED, true)\r\n  }, [])\r\n\r\n  return { consentReceived, onConsentReceipt }\r\n}\r\n\r\nexport { useLegalConsent }\r\n","import React from 'react'\r\nimport { FixedDialog, Text } from '@gnosis.pm/safe-react-components'\r\n\r\ninterface OwnProps {\r\n  onCancel: () => void\r\n  onConfirm: () => void\r\n}\r\n\r\nconst LegalDisclaimer = ({ onCancel, onConfirm }: OwnProps): JSX.Element => (\r\n  <FixedDialog\r\n    body={\r\n      <>\r\n        <Text size=\"md\">\r\n          You are now accessing third-party apps, which we do not own, control, maintain or audit. We are not liable for\r\n          any loss you may suffer in connection with interacting with the apps, which is at your own risk. You must read\r\n          our Terms, which contain more detailed provisions binding on you relating to the apps.\r\n        </Text>\r\n        <br />\r\n        <Text size=\"md\">\r\n          I have read and understood the{' '}\r\n          <a href=\"https://gnosis-safe.io/terms\" rel=\"noopener noreferrer\" target=\"_blank\">\r\n            Terms\r\n          </a>{' '}\r\n          and this Disclaimer, and agree to be bound by them.\r\n        </Text>\r\n      </>\r\n    }\r\n    onCancel={onCancel}\r\n    onConfirm={onConfirm}\r\n    title=\"Disclaimer\"\r\n  />\r\n)\r\n\r\nexport default LegalDisclaimer\r\n","import { MutableRefObject, useEffect, useState } from 'react'\r\nimport {\r\n  getSDKVersion,\r\n  SDKMessageEvent,\r\n  MethodToResponse,\r\n  Methods,\r\n  ErrorResponse,\r\n  MessageFormatter,\r\n  METHODS,\r\n  RequestId,\r\n} from '@gnosis.pm/safe-apps-sdk'\r\nimport { trackError, Errors } from 'src/logic/exceptions/CodedException'\r\nimport { SafeApp } from './types'\r\n\r\ntype MessageHandler = (\r\n  msg: SDKMessageEvent,\r\n) => void | MethodToResponse[Methods] | ErrorResponse | Promise<MethodToResponse[Methods] | ErrorResponse | void>\r\n\r\ntype LegacyMethods = 'getEnvInfo'\r\ntype SDKMethods = Methods | LegacyMethods\r\n\r\nclass AppCommunicator {\r\n  private iframeRef: MutableRefObject<HTMLIFrameElement | null>\r\n  private handlers = new Map<SDKMethods, MessageHandler>()\r\n  private app: SafeApp\r\n\r\n  constructor(iframeRef: MutableRefObject<HTMLIFrameElement | null>, app: SafeApp) {\r\n    this.iframeRef = iframeRef\r\n    this.app = app\r\n\r\n    window.addEventListener('message', this.handleIncomingMessage)\r\n  }\r\n\r\n  on = (method: SDKMethods, handler: MessageHandler): void => {\r\n    this.handlers.set(method, handler)\r\n  }\r\n\r\n  private isValidMessage = (msg: SDKMessageEvent): boolean => {\r\n    // @ts-expect-error .parent doesn't exist on some possible types\r\n    const sentFromIframe = msg.source.parent === window.parent\r\n    const knownMethod = Object.values(METHODS).includes(msg.data.method)\r\n\r\n    return sentFromIframe && knownMethod\r\n  }\r\n\r\n  private canHandleMessage = (msg: SDKMessageEvent): boolean => {\r\n    return Boolean(this.handlers.get(msg.data.method))\r\n  }\r\n\r\n  send = (data: unknown, requestId: RequestId, error = false): void => {\r\n    const sdkVersion = getSDKVersion()\r\n    const msg = error\r\n      ? MessageFormatter.makeErrorResponse(requestId, data as string, sdkVersion)\r\n      : MessageFormatter.makeResponse(requestId, data, sdkVersion)\r\n\r\n    this.iframeRef.current?.contentWindow?.postMessage(msg, '*')\r\n  }\r\n\r\n  handleIncomingMessage = async (msg: SDKMessageEvent): Promise<void> => {\r\n    const validMessage = this.isValidMessage(msg)\r\n    const hasHandler = this.canHandleMessage(msg)\r\n\r\n    if (validMessage && hasHandler) {\r\n      const handler = this.handlers.get(msg.data.method)\r\n      try {\r\n        // @ts-expect-error Handler existence is checked in this.canHandleMessage\r\n        const response = await handler(msg)\r\n\r\n        // If response is not returned, it means the response will be send somewhere else\r\n        if (typeof response !== 'undefined') {\r\n          this.send(response, msg.data.id)\r\n        }\r\n      } catch (err) {\r\n        this.send(err.message, msg.data.id, true)\r\n        trackError(Errors._901, err.message, {\r\n          contexts: {\r\n            safeApp: this.app,\r\n            request: msg.data,\r\n          },\r\n        })\r\n      }\r\n    }\r\n  }\r\n\r\n  clear = (): void => {\r\n    window.removeEventListener('message', this.handleIncomingMessage)\r\n  }\r\n}\r\n\r\nconst useAppCommunicator = (\r\n  iframeRef: MutableRefObject<HTMLIFrameElement | null>,\r\n  app?: SafeApp,\r\n): AppCommunicator | undefined => {\r\n  const [communicator, setCommunicator] = useState<AppCommunicator | undefined>(undefined)\r\n  useEffect(() => {\r\n    let communicatorInstance\r\n    const initCommunicator = (iframeRef: MutableRefObject<HTMLIFrameElement>, app: SafeApp) => {\r\n      communicatorInstance = new AppCommunicator(iframeRef, app)\r\n      setCommunicator(communicatorInstance)\r\n    }\r\n\r\n    if (app) {\r\n      initCommunicator(iframeRef as MutableRefObject<HTMLIFrameElement>, app)\r\n    }\r\n\r\n    return () => {\r\n      communicatorInstance?.clear()\r\n    }\r\n  }, [app, iframeRef])\r\n\r\n  return communicator\r\n}\r\n\r\nexport { useAppCommunicator }\r\n","import React, { ReactElement, useState, useRef, useCallback, useEffect } from 'react'\r\nimport styled from 'styled-components'\r\nimport { FixedIcon, Loader, Title, Card } from '@gnosis.pm/safe-react-components'\r\nimport { GetBalanceParams, GetTxBySafeTxHashParams, MethodToResponse, RPCPayload } from '@gnosis.pm/safe-apps-sdk'\r\nimport { useHistory } from 'react-router-dom'\r\nimport { useSelector } from 'react-redux'\r\nimport { INTERFACE_MESSAGES, Transaction, RequestId, LowercaseNetworks } from '@gnosis.pm/safe-apps-sdk-v1'\r\n\r\nimport { safeEthBalanceSelector, safeParamAddressFromStateSelector } from 'src/logic/safe/store/selectors'\r\nimport { useSafeName } from 'src/logic/addressBook/hooks/useSafeName'\r\nimport { grantedSelector } from 'src/routes/safe/container/selector'\r\nimport { getNetworkId, getNetworkName, getTxServiceUrl } from 'src/config'\r\nimport { SAFELIST_ADDRESS } from 'src/routes/routes'\r\nimport { isSameURL } from 'src/utils/url'\r\nimport { useAnalytics, SAFE_NAVIGATION_EVENT } from 'src/utils/googleAnalytics'\r\nimport { useAppList } from '../hooks/useAppList'\r\nimport { LoadingContainer } from 'src/components/LoaderContainer/index'\r\nimport { TIMEOUT } from 'src/utils/constants'\r\nimport { web3ReadOnly } from 'src/logic/wallets/getWeb3'\r\n\r\nimport { ConfirmTxModal } from '../components/ConfirmTxModal'\r\nimport { useIframeMessageHandler } from '../hooks/useIframeMessageHandler'\r\nimport { useLegalConsent } from '../hooks/useLegalConsent'\r\nimport LegalDisclaimer from './LegalDisclaimer'\r\nimport { getAppInfoFromUrl } from '../utils'\r\nimport { SafeApp } from '../types'\r\nimport { useAppCommunicator } from '../communicator'\r\nimport { fetchTokenCurrenciesBalances } from 'src/logic/safe/api/fetchTokenCurrenciesBalances'\r\nimport { fetchSafeTransaction } from 'src/logic/safe/transactions/api/fetchSafeTransaction'\r\n\r\nconst OwnerDisclaimer = styled.div`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  flex-direction: column;\r\n  height: 476px;\r\n`\r\n\r\nconst AppWrapper = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: calc(100% + 59px);\r\n  margin: 0 -16px;\r\n`\r\n\r\nconst StyledCard = styled(Card)`\r\n  flex-grow: 1;\r\n  padding: 0;\r\n  border-radius: 0;\r\n`\r\n\r\nconst StyledIframe = styled.iframe<{ isLoading: boolean }>`\r\n  height: 100%;\r\n  width: 100%;\r\n  overflow: auto;\r\n  box-sizing: border-box;\r\n  display: ${({ isLoading }) => (isLoading ? 'none' : 'block')};\r\n`\r\n\r\nexport type TransactionParams = {\r\n  safeTxGas?: number\r\n}\r\n\r\ntype ConfirmTransactionModalState = {\r\n  isOpen: boolean\r\n  txs: Transaction[]\r\n  requestId: RequestId\r\n  params?: TransactionParams\r\n}\r\n\r\ntype Props = {\r\n  appUrl: string\r\n}\r\n\r\nconst NETWORK_NAME = getNetworkName()\r\nconst NETWORK_ID = getNetworkId()\r\n\r\nconst INITIAL_CONFIRM_TX_MODAL_STATE: ConfirmTransactionModalState = {\r\n  isOpen: false,\r\n  txs: [],\r\n  requestId: '',\r\n  params: undefined,\r\n}\r\n\r\nconst AppFrame = ({ appUrl }: Props): ReactElement => {\r\n  const granted = useSelector(grantedSelector)\r\n  const safeAddress = useSelector(safeParamAddressFromStateSelector)\r\n  const ethBalance = useSelector(safeEthBalanceSelector)\r\n  const safeName = useSafeName(safeAddress)\r\n  const { trackEvent } = useAnalytics()\r\n  const history = useHistory()\r\n  const { consentReceived, onConsentReceipt } = useLegalConsent()\r\n  const { staticAppsList } = useAppList()\r\n\r\n  const iframeRef = useRef<HTMLIFrameElement>(null)\r\n  const [confirmTransactionModal, setConfirmTransactionModal] = useState<ConfirmTransactionModalState>(\r\n    INITIAL_CONFIRM_TX_MODAL_STATE,\r\n  )\r\n  const [appIsLoading, setAppIsLoading] = useState<boolean>(true)\r\n  const [safeApp, setSafeApp] = useState<SafeApp | undefined>()\r\n\r\n  const redirectToBalance = () => history.push(`${SAFELIST_ADDRESS}/${safeAddress}/balances`)\r\n  const timer = useRef<number>()\r\n  const [appTimeout, setAppTimeout] = useState(false)\r\n\r\n  useEffect(() => {\r\n    if (appIsLoading) {\r\n      timer.current = window.setTimeout(() => {\r\n        setAppTimeout(true)\r\n      }, TIMEOUT)\r\n    } else {\r\n      clearTimeout(timer.current)\r\n      setAppTimeout(false)\r\n    }\r\n\r\n    return () => {\r\n      clearTimeout(timer.current)\r\n    }\r\n  }, [appIsLoading])\r\n\r\n  const openConfirmationModal = useCallback(\r\n    (txs: Transaction[], params: TransactionParams | undefined, requestId: RequestId) =>\r\n      setConfirmTransactionModal({\r\n        isOpen: true,\r\n        txs,\r\n        requestId,\r\n        params,\r\n      }),\r\n    [setConfirmTransactionModal],\r\n  )\r\n  const closeConfirmationModal = useCallback(() => setConfirmTransactionModal(INITIAL_CONFIRM_TX_MODAL_STATE), [\r\n    setConfirmTransactionModal,\r\n  ])\r\n\r\n  const { sendMessageToIframe } = useIframeMessageHandler(\r\n    safeApp,\r\n    openConfirmationModal,\r\n    closeConfirmationModal,\r\n    iframeRef,\r\n  )\r\n\r\n  const onIframeLoad = useCallback(() => {\r\n    const iframe = iframeRef.current\r\n    if (!iframe || !isSameURL(iframe.src, appUrl as string)) {\r\n      return\r\n    }\r\n\r\n    setAppIsLoading(false)\r\n    sendMessageToIframe({\r\n      messageId: INTERFACE_MESSAGES.ON_SAFE_INFO,\r\n      data: {\r\n        safeAddress: safeAddress as string,\r\n        network: NETWORK_NAME.toLowerCase() as LowercaseNetworks,\r\n        ethBalance: ethBalance as string,\r\n      },\r\n    })\r\n  }, [ethBalance, safeAddress, appUrl, sendMessageToIframe])\r\n\r\n  const communicator = useAppCommunicator(iframeRef, safeApp)\r\n\r\n  useEffect(() => {\r\n    communicator?.on('getEnvInfo', () => ({\r\n      txServiceUrl: getTxServiceUrl(),\r\n    }))\r\n\r\n    communicator?.on('getTxBySafeTxHash', async (msg) => {\r\n      const { safeTxHash } = msg.data.params as GetTxBySafeTxHashParams\r\n\r\n      const tx = await fetchSafeTransaction(safeTxHash)\r\n\r\n      return tx\r\n    })\r\n\r\n    communicator?.on('getSafeInfo', () => ({\r\n      safeAddress,\r\n      network: NETWORK_NAME,\r\n      chainId: NETWORK_ID,\r\n    }))\r\n\r\n    communicator?.on('getSafeBalances', async (msg) => {\r\n      const { currency = 'usd' } = msg.data.params as GetBalanceParams\r\n\r\n      const balances = await fetchTokenCurrenciesBalances({ safeAddress, selectedCurrency: currency })\r\n\r\n      return balances\r\n    })\r\n\r\n    communicator?.on('rpcCall', async (msg) => {\r\n      const params = msg.data.params as RPCPayload\r\n\r\n      try {\r\n        const response = new Promise<MethodToResponse['rpcCall']>((resolve, reject) => {\r\n          if (\r\n            web3ReadOnly.currentProvider !== null &&\r\n            typeof web3ReadOnly.currentProvider !== 'string' &&\r\n            'send' in web3ReadOnly.currentProvider\r\n          ) {\r\n            web3ReadOnly.currentProvider?.send?.(\r\n              {\r\n                jsonrpc: '2.0',\r\n                method: params.call,\r\n                params: params.params,\r\n                id: '1',\r\n              },\r\n              (err, res) => {\r\n                if (err || res?.error) {\r\n                  reject(err || res?.error)\r\n                }\r\n\r\n                resolve(res?.result)\r\n              },\r\n            )\r\n          }\r\n        })\r\n\r\n        return response\r\n      } catch (err) {\r\n        return err\r\n      }\r\n    })\r\n\r\n    communicator?.on('sendTransactions', (msg) => {\r\n      // @ts-expect-error explore ways to fix this\r\n      openConfirmationModal(msg.data.params.txs as Transaction[], msg.data.params.params, msg.data.id)\r\n    })\r\n  }, [communicator, openConfirmationModal, safeAddress])\r\n\r\n  const onUserTxConfirm = (safeTxHash: string) => {\r\n    // Safe Apps SDK V1 Handler\r\n    sendMessageToIframe(\r\n      { messageId: INTERFACE_MESSAGES.TRANSACTION_CONFIRMED, data: { safeTxHash } },\r\n      confirmTransactionModal.requestId,\r\n    )\r\n\r\n    // Safe Apps SDK V2 Handler\r\n    communicator?.send({ safeTxHash }, confirmTransactionModal.requestId as string)\r\n  }\r\n\r\n  const onTxReject = () => {\r\n    // Safe Apps SDK V1 Handler\r\n    sendMessageToIframe(\r\n      { messageId: INTERFACE_MESSAGES.TRANSACTION_REJECTED, data: {} },\r\n      confirmTransactionModal.requestId,\r\n    )\r\n\r\n    // Safe Apps SDK V2 Handler\r\n    communicator?.send('Transaction was rejected', confirmTransactionModal.requestId as string, true)\r\n  }\r\n\r\n  useEffect(() => {\r\n    const loadApp = async () => {\r\n      const app = await getAppInfoFromUrl(appUrl)\r\n\r\n      setSafeApp(app)\r\n    }\r\n    if (staticAppsList.length) {\r\n      loadApp()\r\n    }\r\n  }, [appUrl, staticAppsList])\r\n\r\n  //track GA\r\n  useEffect(() => {\r\n    if (safeApp) {\r\n      trackEvent({ category: SAFE_NAVIGATION_EVENT, action: 'Apps', label: safeApp.name })\r\n    }\r\n  }, [safeApp, trackEvent])\r\n\r\n  if (!appUrl) {\r\n    throw Error('App url No provided or it is invalid.')\r\n  }\r\n\r\n  if (!safeApp) {\r\n    return (\r\n      <LoadingContainer>\r\n        <Loader size=\"md\" />\r\n      </LoadingContainer>\r\n    )\r\n  }\r\n\r\n  if (consentReceived === false) {\r\n    return <LegalDisclaimer onCancel={redirectToBalance} onConfirm={onConsentReceipt} />\r\n  }\r\n\r\n  if (NETWORK_NAME === 'UNKNOWN' || !granted) {\r\n    return (\r\n      <OwnerDisclaimer>\r\n        <FixedIcon type=\"notOwner\" />\r\n        <Title size=\"xs\">To use apps, you must be an owner of this Safe</Title>\r\n      </OwnerDisclaimer>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <AppWrapper>\r\n      <StyledCard>\r\n        {appIsLoading && (\r\n          <LoadingContainer style={{ flexDirection: 'column' }}>\r\n            {appTimeout && (\r\n              <Title size=\"xs\">\r\n                The safe app is taking longer than usual to load. There might be a problem with the app provider.\r\n              </Title>\r\n            )}\r\n            <Loader size=\"md\" />\r\n          </LoadingContainer>\r\n        )}\r\n\r\n        <StyledIframe\r\n          isLoading={appIsLoading}\r\n          frameBorder=\"0\"\r\n          id={`iframe-${appUrl}`}\r\n          ref={iframeRef}\r\n          src={appUrl}\r\n          title={safeApp.name}\r\n          onLoad={onIframeLoad}\r\n        />\r\n      </StyledCard>\r\n\r\n      <ConfirmTxModal\r\n        isOpen={confirmTransactionModal.isOpen}\r\n        app={safeApp as SafeApp}\r\n        safeAddress={safeAddress}\r\n        ethBalance={ethBalance as string}\r\n        safeName={safeName as string}\r\n        txs={confirmTransactionModal.txs}\r\n        onClose={closeConfirmationModal}\r\n        onUserConfirm={onUserTxConfirm}\r\n        params={confirmTransactionModal.params}\r\n        onTxReject={onTxReject}\r\n      />\r\n    </AppWrapper>\r\n  )\r\n}\r\n\r\nexport default AppFrame\r\n","import styled, { keyframes } from 'styled-components'\r\n\r\nconst gradientSK = keyframes`\r\n  0% {\r\n    background-position: 0% 54%;\r\n  }\r\n  50% {\r\n    background-position: 100% 47%;\r\n  }\r\n  100% {\r\n    background-position: 0% 54%;\r\n  }\r\n`\r\n\r\nexport const AppIconSK = styled.div`\r\n  height: 60px;\r\n  width: 60px;\r\n  border-radius: 30px;\r\n  margin: 0 auto;\r\n  background-color: lightgrey;\r\n  background: linear-gradient(84deg, lightgrey, transparent);\r\n  background-size: 400% 400%;\r\n  animation: ${gradientSK} 1.5s ease infinite;\r\n`\r\nexport const TitleSK = styled.div`\r\n  height: 24px;\r\n  width: 160px;\r\n  margin: 24px auto;\r\n  background-color: lightgrey;\r\n  background: linear-gradient(84deg, lightgrey, transparent);\r\n  background-size: 400% 400%;\r\n  animation: ${gradientSK} 1.5s ease infinite;\r\n`\r\nexport const DescriptionSK = styled.div`\r\n  height: 16px;\r\n  width: 200px;\r\n  background-color: lightgrey;\r\n  background: linear-gradient(84deg, lightgrey, transparent);\r\n  background-size: 400% 400%;\r\n  animation: ${gradientSK} 1.5s ease infinite;\r\n`\r\n","export default __webpack_public_path__ + \"static/media/addApp.4a0829b7.svg\";","import { Checkbox, Text } from '@gnosis.pm/safe-react-components'\r\nimport React from 'react'\r\nimport { useFormState } from 'react-final-form'\r\nimport styled from 'styled-components'\r\n\r\nimport { required } from 'src/components/forms/validator'\r\nimport Field from 'src/components/forms/Field'\r\n\r\nconst StyledCheckbox = styled(Checkbox)`\r\n  margin: 0;\r\n`\r\n\r\nconst AppAgreement = (): React.ReactElement => {\r\n  const { visited } = useFormState({ subscription: { visited: true } })\r\n\r\n  // trick to prevent having the field validated by default. Not sure why this happens in this form\r\n  const validate = !visited?.agreementAccepted ? undefined : required\r\n\r\n  return (\r\n    <Field\r\n      component={StyledCheckbox}\r\n      label={<Text size=\"xl\">This app is not a Gnosis product and I agree to use this app at my own risk.</Text>}\r\n      name=\"agreementAccepted\"\r\n      type=\"checkbox\"\r\n      validate={validate}\r\n    />\r\n  )\r\n}\r\n\r\nexport default AppAgreement\r\n","import debounce from 'lodash.debounce'\r\nimport { useCallback, useEffect, useState, useRef } from 'react'\r\n\r\n/*\r\n  This code snippet is copied from https://github.com/gnbaron/use-lodash-debounce\r\n  with the sole intention to be able to tweak it if is needed and prevent from having\r\n  a new dependency for something relatively trivial\r\n*/\r\n\r\ninterface DebounceOptions {\r\n  leading: boolean\r\n  maxWait: number\r\n  trailing: boolean\r\n}\r\n\r\nexport const useDebouncedCallback = <T extends (...args: unknown[]) => unknown>(\r\n  callback: T,\r\n  delay = 0,\r\n  options?: DebounceOptions,\r\n): T & { cancel: () => void } => useCallback(debounce(callback, delay, options), [callback, delay, options])\r\n\r\nexport const useDebounce = <T extends unknown>(value: T, delay = 0, options?: DebounceOptions): T => {\r\n  const previousValue = useRef(value)\r\n  const [current, setCurrent] = useState(value)\r\n  const debouncedCallback = useDebouncedCallback((value: T) => setCurrent(value), delay, options)\r\n\r\n  useEffect(() => {\r\n    // does trigger the debounce timer initially\r\n    if (value !== previousValue.current) {\r\n      debouncedCallback(value)\r\n      previousValue.current = value\r\n      // cancel the debounced callback on clean up\r\n      return debouncedCallback.cancel\r\n    }\r\n  }, [debouncedCallback, value])\r\n\r\n  return current\r\n}\r\n","import { TextField } from '@gnosis.pm/safe-react-components'\r\nimport createDecorator from 'final-form-calculate'\r\nimport React from 'react'\r\nimport { useField, useFormState } from 'react-final-form'\r\nimport styled from 'styled-components'\r\n\r\nimport { SafeApp } from 'src/routes/safe/components/Apps/types'\r\nimport { getAppInfoFromUrl, getIpfsLinkFromEns, uniqueApp } from 'src/routes/safe/components/Apps/utils'\r\nimport { composeValidators, required } from 'src/components/forms/validator'\r\nimport Field from 'src/components/forms/Field'\r\nimport { isValidURL } from 'src/utils/url'\r\nimport { isValidEnsName } from 'src/logic/wallets/ethAddresses'\r\nimport { useDebounce } from 'src/logic/hooks/useDebounce'\r\n\r\nconst validateUrl = (url: string): string | undefined => (isValidURL(url) ? undefined : 'Invalid URL')\r\n\r\nexport const appUrlResolver = createDecorator({\r\n  field: 'appUrl',\r\n  updates: {\r\n    appUrl: async (appUrl: string): Promise<string | undefined> => {\r\n      const ensContent = !isValidURL(appUrl) && isValidEnsName(appUrl) && (await getIpfsLinkFromEns(appUrl))\r\n\r\n      if (ensContent) {\r\n        return ensContent\r\n      }\r\n\r\n      return appUrl\r\n    },\r\n  },\r\n})\r\n\r\ntype AppInfoUpdaterProps = {\r\n  onAppInfo: (appInfo: SafeApp) => void\r\n  onLoading: (isLoading: boolean) => void\r\n}\r\n\r\nexport const AppInfoUpdater = ({ onAppInfo, onLoading }: AppInfoUpdaterProps): null => {\r\n  const {\r\n    input: { value: appUrl },\r\n  } = useField('appUrl', { subscription: { value: true } })\r\n\r\n  const debouncedValue = useDebounce(appUrl, 500)\r\n\r\n  React.useEffect(() => {\r\n    const updateAppInfo = async () => {\r\n      try {\r\n        onLoading(true)\r\n        const appInfo = await getAppInfoFromUrl(debouncedValue)\r\n        onAppInfo({ ...appInfo })\r\n        onLoading(false)\r\n      } catch (error) {\r\n        onLoading(false)\r\n      }\r\n    }\r\n\r\n    if (isValidURL(debouncedValue)) {\r\n      updateAppInfo()\r\n    }\r\n  }, [debouncedValue, onAppInfo, onLoading])\r\n\r\n  return null\r\n}\r\n\r\nconst StyledAppUrlField = styled(Field)`\r\n  && {\r\n    width: 100%;\r\n  }\r\n`\r\n\r\nconst AppUrl = ({ appList }: { appList: SafeApp[] }): React.ReactElement => {\r\n  const { visited } = useFormState({ subscription: { visited: true } })\r\n\r\n  // trick to prevent having the field validated by default. Not sure why this happens in this form\r\n  const validate = !visited?.appUrl ? undefined : composeValidators(required, validateUrl, uniqueApp(appList))\r\n\r\n  return (\r\n    <StyledAppUrlField\r\n      label=\"App URL\"\r\n      name=\"appUrl\"\r\n      placeholder=\"App URL\"\r\n      type=\"text\"\r\n      component={TextField}\r\n      validate={validate}\r\n      autoComplete=\"off\"\r\n    />\r\n  )\r\n}\r\n\r\nexport default AppUrl\r\n","import React, { ReactElement, useMemo } from 'react'\r\nimport { useFormState } from 'react-final-form'\r\n\r\nimport { Modal } from 'src/components/Modal'\r\nimport { SafeApp } from 'src/routes/safe/components/Apps/types'\r\nimport { isAppManifestValid } from 'src/routes/safe/components/Apps/utils'\r\n\r\ninterface Props {\r\n  appInfo: SafeApp\r\n  onCancel: () => void\r\n}\r\n\r\nexport const FormButtons = ({ appInfo, onCancel }: Props): ReactElement => {\r\n  const { valid, validating, visited } = useFormState({\r\n    subscription: { valid: true, validating: true, visited: true },\r\n  })\r\n\r\n  const isSubmitDisabled = useMemo(() => {\r\n    // if non visited, fields were not evaluated yet. Then, the default value is considered invalid\r\n    const fieldsVisited = visited?.agreementAccepted && visited?.appUrl\r\n\r\n    return validating || !valid || !fieldsVisited || !isAppManifestValid(appInfo)\r\n  }, [validating, valid, visited, appInfo])\r\n\r\n  return (\r\n    <Modal.Footer.Buttons\r\n      cancelButtonProps={{ onClick: onCancel }}\r\n      confirmButtonProps={{ disabled: isSubmitDisabled, text: 'Add' }}\r\n    />\r\n  )\r\n}\r\n","import { Icon, Link, Loader, Text, TextField } from '@gnosis.pm/safe-react-components'\r\nimport React, { useState, ReactElement } from 'react'\r\nimport styled from 'styled-components'\r\n\r\nimport { SafeApp } from 'src/routes/safe/components/Apps/types'\r\nimport GnoForm from 'src/components/forms/GnoForm'\r\nimport Img from 'src/components/layout/Img'\r\nimport { Modal } from 'src/components/Modal'\r\n\r\nimport AppAgreement from './AppAgreement'\r\nimport AppUrl, { AppInfoUpdater, appUrlResolver } from './AppUrl'\r\nimport { FormButtons } from './FormButtons'\r\nimport { APPS_STORAGE_KEY, getEmptySafeApp } from 'src/routes/safe/components/Apps/utils'\r\nimport { saveToStorage } from 'src/utils/storage'\r\nimport { SAFELIST_ADDRESS } from 'src/routes/routes'\r\nimport { useHistory, useRouteMatch } from 'react-router-dom'\r\n\r\nconst FORM_ID = 'add-apps-form'\r\n\r\nconst StyledTextFileAppName = styled(TextField)`\r\n  && {\r\n    width: 385px;\r\n  }\r\n`\r\n\r\nconst AppInfo = styled.div`\r\n  display: flex;\r\n  margin: 36px 0 24px 0;\r\n\r\n  img {\r\n    margin-right: 10px;\r\n  }\r\n`\r\nconst AppDocsInfo = styled.div`\r\n  display: flex;\r\n  margin-bottom: 24px;\r\n  flex-direction: column;\r\n  svg {\r\n    position: relative;\r\n    top: 4px;\r\n    left: 4px;\r\n  }\r\n`\r\n\r\nconst WrapperLoader = styled.div`\r\n  height: 55px;\r\n  width: 65px;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n`\r\n\r\nconst StyledLoader = styled(Loader)`\r\n  margin-right: 15px;\r\n`\r\n\r\ninterface AddAppFormValues {\r\n  appUrl: string\r\n  agreementAccepted: boolean\r\n}\r\n\r\nconst INITIAL_VALUES: AddAppFormValues = {\r\n  appUrl: '',\r\n  agreementAccepted: false,\r\n}\r\n\r\nconst APP_INFO = getEmptySafeApp()\r\n\r\ninterface AddAppProps {\r\n  appList: SafeApp[]\r\n  closeModal: () => void\r\n}\r\n\r\nconst AddApp = ({ appList, closeModal }: AddAppProps): ReactElement => {\r\n  const [appInfo, setAppInfo] = useState<SafeApp>(APP_INFO)\r\n  const history = useHistory()\r\n  const matchSafeWithAddress = useRouteMatch<{ safeAddress: string }>({ path: `${SAFELIST_ADDRESS}/:safeAddress` })\r\n  const [isLoading, setIsLoading] = useState(false)\r\n\r\n  const handleSubmit = () => {\r\n    const newAppList = [\r\n      { url: appInfo.url, disabled: false },\r\n      ...appList.map(({ url, disabled }) => ({ url, disabled })),\r\n    ]\r\n    saveToStorage(APPS_STORAGE_KEY, newAppList)\r\n    const goToApp = `${matchSafeWithAddress?.url}/apps?appUrl=${encodeURI(appInfo.url)}`\r\n    history.push(goToApp)\r\n  }\r\n\r\n  return (\r\n    <GnoForm decorators={[appUrlResolver]} initialValues={INITIAL_VALUES} onSubmit={handleSubmit} testId={FORM_ID}>\r\n      {() => (\r\n        <>\r\n          <Modal.Body>\r\n            <AppDocsInfo>\r\n              <Text size=\"xl\" as=\"span\" color=\"secondary\">\r\n                Safe Apps are third-party extensions.\r\n              </Text>\r\n              <Link\r\n                href=\"https://docs.gnosis.io/safe/docs/sdks_safe_apps/\"\r\n                target=\"_blank\"\r\n                rel=\"noreferrer\"\r\n                title=\"Learn more about building Safe Apps\"\r\n              >\r\n                <Text size=\"xl\" as=\"span\" color=\"primary\">\r\n                  Learn more about building Safe Apps.\r\n                </Text>\r\n                <Icon size=\"sm\" type=\"externalLink\" color=\"primary\" />\r\n              </Link>\r\n            </AppDocsInfo>\r\n            <AppUrl appList={appList} />\r\n            {/* Fetch app from url and return a SafeApp */}\r\n            <AppInfoUpdater onAppInfo={setAppInfo} onLoading={setIsLoading} />\r\n            <AppInfo>\r\n              {isLoading ? (\r\n                <WrapperLoader>\r\n                  <StyledLoader size=\"sm\" />\r\n                </WrapperLoader>\r\n              ) : (\r\n                <Img alt=\"Token image\" width={55} src={appInfo.iconUrl} />\r\n              )}\r\n              <StyledTextFileAppName\r\n                label=\"App name\"\r\n                readOnly\r\n                value={isLoading ? 'Loading...' : appInfo.name}\r\n                onChange={() => {}}\r\n              />\r\n            </AppInfo>\r\n            <AppAgreement />\r\n          </Modal.Body>\r\n          <Modal.Footer>\r\n            <FormButtons appInfo={appInfo} onCancel={closeModal} />\r\n          </Modal.Footer>\r\n        </>\r\n      )}\r\n    </GnoForm>\r\n  )\r\n}\r\n\r\nexport default AddApp\r\n","import React, { useState } from 'react'\r\nimport styled, { css } from 'styled-components'\r\nimport { useSelector } from 'react-redux'\r\nimport { IconText, Loader, Menu, Text, Icon } from '@gnosis.pm/safe-react-components'\r\nimport IconButton from '@material-ui/core/IconButton'\r\n\r\nimport { Modal } from 'src/components/Modal'\r\nimport { safeParamAddressFromStateSelector } from 'src/logic/safe/store/selectors'\r\nimport AppCard from 'src/routes/safe/components/Apps/components/AppCard'\r\nimport AddAppIcon from 'src/routes/safe/components/Apps/assets/addApp.svg'\r\nimport { useRouteMatch, Link } from 'react-router-dom'\r\nimport { SAFELIST_ADDRESS } from 'src/routes/routes'\r\n\r\nimport { useAppList } from '../hooks/useAppList'\r\nimport { SAFE_APP_FETCH_STATUS, SafeApp } from '../types'\r\nimport AddAppForm from './AddAppForm'\r\nimport { AppData } from '../api/fetchSafeAppsList'\r\n\r\nconst Wrapper = styled.div`\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n`\r\n\r\nconst StyledLink = styled(Link)`\r\n  text-decoration: none;\r\n`\r\n\r\nconst centerCSS = css`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n`\r\n\r\nconst LoadingContainer = styled.div`\r\n  width: 100%;\r\n  height: 100%;\r\n  ${centerCSS};\r\n`\r\n\r\nconst CardsWrapper = styled.div`\r\n  width: 100%;\r\n  display: grid;\r\n  grid-template-columns: repeat(auto-fill, minmax(243px, 1fr));\r\n  column-gap: 20px;\r\n  row-gap: 20px;\r\n  justify-content: space-evenly;\r\n  margin: 0 0 16px 0;\r\n`\r\n\r\nconst ContentWrapper = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: space-between;\r\n  flex-grow: 1;\r\n  align-items: center;\r\n`\r\nconst Breadcrumb = styled.div`\r\n  height: 51px;\r\n`\r\n\r\nconst IconBtn = styled(IconButton)`\r\n  position: absolute;\r\n  top: 10px;\r\n  right: 10px;\r\n  z-index: 10;\r\n  padding: 5px;\r\n  opacity: 0;\r\n\r\n  transition: opacity 0.2s ease-in-out;\r\n`\r\n\r\nconst AppContainer = styled.div`\r\n  position: relative;\r\n\r\n  &:hover {\r\n    ${IconBtn} {\r\n      opacity: 1;\r\n    }\r\n  }\r\n`\r\n\r\nconst isAppLoading = (app: SafeApp) => SAFE_APP_FETCH_STATUS.LOADING === app.fetchStatus\r\nconst isCustomApp = (appUrl: string, staticAppsList: AppData[]) => !staticAppsList.some(({ url }) => url === appUrl)\r\n\r\nconst AppsList = (): React.ReactElement => {\r\n  const matchSafeWithAddress = useRouteMatch<{ safeAddress: string }>({ path: `${SAFELIST_ADDRESS}/:safeAddress` })\r\n  const safeAddress = useSelector(safeParamAddressFromStateSelector)\r\n  const { appList, removeApp, staticAppsList } = useAppList()\r\n  const [isAddAppModalOpen, setIsAddAppModalOpen] = useState<boolean>(false)\r\n  const [appToRemove, setAppToRemove] = useState<SafeApp | null>(null)\r\n\r\n  const openAddAppModal = () => setIsAddAppModalOpen(true)\r\n\r\n  const closeAddAppModal = () => setIsAddAppModalOpen(false)\r\n\r\n  if (!appList.length || !safeAddress) {\r\n    return (\r\n      <LoadingContainer>\r\n        <Loader size=\"md\" />\r\n      </LoadingContainer>\r\n    )\r\n  }\r\n\r\n  return (\r\n    <Wrapper>\r\n      <Menu>\r\n        {/* TODO: Add navigation breadcrumb. Empty for now to give some top margin */}\r\n        <Breadcrumb />\r\n      </Menu>\r\n\r\n      <ContentWrapper>\r\n        <CardsWrapper>\r\n          <AppCard iconUrl={AddAppIcon} onClick={openAddAppModal} buttonText=\"Add custom app\" iconSize=\"lg\" />\r\n\r\n          {appList\r\n            .filter((a) => a.fetchStatus !== SAFE_APP_FETCH_STATUS.ERROR)\r\n            .map((a) => (\r\n              <AppContainer key={a.url}>\r\n                <StyledLink key={a.url} to={`${matchSafeWithAddress?.url}/apps?appUrl=${encodeURI(a.url)}`}>\r\n                  <AppCard isLoading={isAppLoading(a)} iconUrl={a.iconUrl} name={a.name} description={a.description} />\r\n                </StyledLink>\r\n                {isCustomApp(a.url, staticAppsList) && (\r\n                  <IconBtn\r\n                    title=\"Remove\"\r\n                    onClick={(e) => {\r\n                      e.stopPropagation()\r\n\r\n                      setAppToRemove(a)\r\n                    }}\r\n                  >\r\n                    <Icon size=\"sm\" type=\"delete\" color=\"error\" />\r\n                  </IconBtn>\r\n                )}\r\n              </AppContainer>\r\n            ))}\r\n        </CardsWrapper>\r\n\r\n        <IconText\r\n          color=\"secondary\"\r\n          iconSize=\"sm\"\r\n          iconType=\"info\"\r\n          text=\"These are third-party apps, which means they are not owned, controlled, maintained or audited by Gnosis. Interacting with the apps is at your own risk. Any communication within the Apps is for informational purposes only and must not be construed as investment advice to engage in any transaction.\"\r\n          textSize=\"sm\"\r\n        />\r\n      </ContentWrapper>\r\n\r\n      {isAddAppModalOpen && (\r\n        <Modal title=\"Add app\" description=\"Add a custom app to the list of apps\" handleClose={closeAddAppModal}>\r\n          <Modal.Header onClose={closeAddAppModal}>\r\n            <Modal.Header.Title>Add custom app</Modal.Header.Title>\r\n          </Modal.Header>\r\n          <AddAppForm closeModal={closeAddAppModal} appList={appList} />\r\n        </Modal>\r\n      )}\r\n\r\n      {appToRemove && (\r\n        <Modal title=\"Remove app\" description=\"Confirm for the app removal\" handleClose={() => setAppToRemove(null)}>\r\n          <Modal.Header onClose={() => setAppToRemove(null)}>\r\n            <Modal.Header.Title>Remove app</Modal.Header.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            <Text size=\"xl\">\r\n              This action will remove{' '}\r\n              <Text size=\"xl\" strong as=\"span\">\r\n                {appToRemove.name}\r\n              </Text>{' '}\r\n              from the interface\r\n            </Text>\r\n          </Modal.Body>\r\n          <Modal.Footer>\r\n            <Modal.Footer.Buttons\r\n              cancelButtonProps={{ onClick: () => setAppToRemove(null) }}\r\n              confirmButtonProps={{\r\n                color: 'error',\r\n                onClick: () => {\r\n                  removeApp(appToRemove.url)\r\n                  setAppToRemove(null)\r\n                },\r\n                text: 'Remove',\r\n              }}\r\n            />\r\n          </Modal.Footer>\r\n        </Modal>\r\n      )}\r\n    </Wrapper>\r\n  )\r\n}\r\n\r\nexport default AppsList\r\n","import React from 'react'\r\n\r\nimport { useLocation } from 'react-router-dom'\r\n\r\nimport AppFrame from './components/AppFrame'\r\nimport AppsList from './components/AppsList'\r\n\r\nconst useQuery = () => {\r\n  return new URLSearchParams(useLocation().search)\r\n}\r\n\r\nconst Apps = (): React.ReactElement => {\r\n  const query = useQuery()\r\n  const appUrl = query.get('appUrl')\r\n\r\n  if (appUrl) {\r\n    return <AppFrame appUrl={appUrl} />\r\n  } else {\r\n    return <AppsList />\r\n  }\r\n}\r\n\r\nexport default Apps\r\n"],"sourceRoot":""}